## 7. ì•ˆë“œë¡œì´ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ê³„ íŒ¨í„´

- ì¼ë°˜ì ì¸ MVC, MVP, MVVM ë””ìì¸ íŒ¨í„´

### MVC ë””ìì¸ íŒ¨í„´

- Model, View, Controller ë¡œ ê´€ì‹¬ì‚¬ ë¶„ë¦¬
- ì•ˆë“œë¡œì´ë“œ í”Œë«í¼ ë“±ì¥ ì´ˆê¸°ì— ìì—°ìŠ¤ëŸ½ê²Œ ì ìš©ë˜ê¸° ì‹œì‘

#### ëª¨ë¸ì˜ ì—­í• 

- ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ì‚¬ìš© ë˜ëŠ” ë°ì´í„°ë¥¼ ë‹¤ë£¸
- í‘œí˜„ í˜•ì‹ì— ì˜ì¡´ì ì´ì§€ ì•Šê³ , ì‚¬ìš©ìì—ê²Œ ë³´ì´ì§€ ì•Šì•„ ì–´ë–»ê²Œ ë³´ì¼ì§€ ì‹ ê²½ì“°ì§€ ì•Šì•„ë„ë¨
- ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„° = DBMSì— ì˜í•´ì„œ ê´€ë¦¬
- ëª‡ í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ë°ì´í„°ë¥¼ ì œê³µ, ì…ë ¥, ìˆ˜ì •
- ì•ˆë“œë¡œì´ë“œì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì˜ Entity ë¥¼ ë‹´ë‹¹í•˜ëŠ” POJO í´ë˜ìŠ¤ë¥¼ í¬í•¨í•œ SQLite, Room, Realm ë“±

[POJO í´ë˜ìŠ¤ ì˜ˆì‹œ]
```kotlin
data class Employee(
    var name: String, var id: String,
    val salary: Double
)
```

#### ë·°ì˜ ì—­í• 

- ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” ì˜ì—­
- ëª¨ë¸ë¡œ ë¶€í„° ì–»ì€ ë°ì´í„°ë¥¼ ë·°ì—ì„œ ë‚˜íƒ€ëƒ„
- ì•ˆë“œë¡œì´ë“œì—ì„œ Activity, Fragment ê°€ ê·¸ ì˜ˆì‹œ

#### ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì—­í• 

- ëª¨ë¸ê³¼ ë·°ì— ì˜ì¡´
- ë·°ë¡œ ë¶€í„° ì…ë ¥ ë°›ê±°ë‚˜, íŠ¹ì • ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ëª¨ë¸ ë˜ëŠ” ë·°ë¥¼ ë³€ê²½
- ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì…ë ¥ë˜ëŠ” ëª¨ë¸ë¡œ ì „ë‹¬í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê³  ê·¸ ë™ì‹œì— ëª¨ë¸ì˜ ìƒíƒœ ë³€í™”ë¥¼ ê°ì§€í•˜ì—¬ ë“±ë¡ëœ ë·°ì— ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸ í•´ì„œ ë³´ì—¬ì¤„ ìˆ˜ ìˆëŠ”ê²ƒ.
- MVC ì—ì„œëŠ” Activity ì™€ FragmentëŠ” ë·°ì˜ ì—­í• ë„ í•˜ê³  ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì—­í• ë„ í•œë‹¤.

![MVC ë‹¤ì´ì–´ê·¸ë¨]()

- ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë·°ì™€ ëª¨ë¸ì— ì˜ì¡´
- ë·°ëŠ” ëª¨ëŒˆ ìƒíƒœ ë³€í™”ì— ë”°ë¼ ëŠ¥ë™ì ì¸ ëŒ€ì‘ì„ í•¨

#### MVC ë””ìì¸ íŒ¨í„´ì˜ ì¥ë‹¨ì 

- ì§ê´€ì 
- ê·œëª¨ê°€ ì ì€ ì•±ì— ì ìš©ì‹œ ê°œë°œ ê¸°ê°„ ë‹¨ì¶•ê°€ëŠ¥
- ëª¨ë“  ì½”ë“œê°€ ì•¡í‹°ë¹„í‹°, í”„ë˜ê·¸ë¨¼íŠ¸ ê°™ì€ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì‘ì„±ë˜ëŠ” ê²½í–¥ -> ì½”ë“œ íŒŒì•… í¸ë¦¬
- ì½”ë“œëŸ‰ ì¦ê°€ ì‹œ ìŠ¤íŒŒì¼€í‹° ì½”ë“œë¡œ ì „ë½.. -> ì‹œê°„ íë¥¼ ìˆ˜ë¡ ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ì¦ê°€!
- ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë·°ì™€ ëª¨ë¸ì— ì˜ì¡´, ë·°ëŠ” ëª¨ë¸ì— ì˜ì¡´. -> ê²°í•©ë„ ë†’ì•„..! -> ìœ ë‹› í…ŒìŠ¤íŠ¸ ê±°ì˜ ë¶ˆê°€ëŠ¥

---

### MVP ë””ìì¸ íŒ¨í„´

- MVC ëŠ” UIì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ Activity ì™€ Fragmentì— ê³µì¡´
- MVP ë””ìì¸ íŒ¨í„´ì€ ë¹„ìŠ·í•˜ì§€ë§Œ Activity ì™€ Fragmentì˜ UI , ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë¶„ë¦¬í•˜ëŠ”ë° ì§‘ì¤‘

![MVP ë‹¤ì´ì–´ê·¸ë¨]()

- model ê³¼ view ì˜ ì—­í• ì€ MPC ì™€ ë¹„ìŠ·í—ˆë‚˜
- controller ëŒ€ì‹œ presenter ë¼ëŠ” ê°œë… ì‚¬ìš©
- UI ì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶„ë¦¬ -> ìœ ë‹› í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

#### MVP ë””ìì¸ íŒ¨í„´ ì¥ì 

- Presenter ëŠ” View ì™€ Modelì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì§€ë©´ì„œ ì´ ë‘˜ì„ ì—°ê²°í•´ì£¼ëŠ” ì—­í• .
    - Presenter ì™€ View ëŠ” 1:1 ê´€ê³„ë¥¼ ê°–ìŒ

- View model ê°„ì˜ ì˜ì¡´ì„±ì´ ì—†ìŒ (ì¥ì )
- UI / ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶„ë¦¬ (ìœ ë‹› í…ŒìŠ¤íŠ¸ ìˆ˜ì›”)
- í•˜ì§€ë§Œ, View / Presenter ê°„ì˜ ì˜ì¡´ì„±ì´ ë†’ê³  1:1 ê´€ê³„ë¥¼ ìœ ì§€í•´ì•¼ í•˜ë¯€ë¡œ Presenter ë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
    - view ê°€ ëŠ˜ì–´ë‚  ë•Œë§ˆë‹¤ Presenter ë„ ê°™ì´ ëŠ˜ì–´ë‚¨. í´ë˜ìŠ¤ê°€ ë§ì•„ì§€ê²Œ ëœë‹¤...
    - ì•±ì˜ ê¸°ëŠ¥ì´ ì¶”ê°€ë  ìˆ˜ë¡ Presenterê°€ ê±°ëŒ€í•´ì§...

#### MVP ë””ìì¸ íŒ¨í„´ êµ¬í˜„í•˜ê¸°

##### Contract Class ë§Œë“¤ê¸°

- êµ¬ì„± ìš”ì†Œì˜ í˜í• ê³¼ ê´€ê³„ì˜ ì •ì˜
- êµ¬ì„± ìš”ì†Œ = View, Presenter ì •ë„
- Model = Contract í´ë˜ìŠ¤ì— í¬í•¨ ë˜ëŠ” Repository íŒ¨í„´ìœ¼ë¡œ ë”°ë¡œ ì •ì˜

```kotlin
class MainContract {
    interface View {
        fun showPersonList(personList: List<Person>)
        fun notifyDataChanged()
    }

    interface Presenter {
        fun load()
        fun addPerson(person: Person)
        fun removePerson(person: Person)
    }
}
```

##### Presenter Class ë§Œë“¤ê¸°

- View ì˜ ì—­í• 
    1. View ì¸í„°í˜ì´ìŠ¤ì— ì •ì˜ëœ ë§¤ì„œë“œ ì¬ì •ì˜ë¡œ ë°ì´í„°ë¥¼ í™”ë©´ì— ë¿Œë¦¼
    2. Presenter ìƒëª… ì£¼ê¸° ë˜ëŠ” Click eventì— ëŒ€í•œ ë‚´ìš© ì•Œë¦¼
- View ì¸í„°í˜ì´ìŠ¤ëŠ” Activity, Fragment ì— ì£¼ë¡œ êµ¬í˜„

```kotlin
class MainPresenter(database: Database, view: MainContract.View) : Presenter {
    private val database: Database
    private val view: MainContract.View // ì˜¤ë¡œì§€ ê³„ì•½ëœ MainContract.Presenter ì—ë§Œ ì°¸ì¡° ëœë‹¤
    override fun load() {
        view.showPersonList(database.getPersonList())
    }

    override fun addPerson(person: Person) {
        database.add(person)
    }

    override fun removePerson(person: Person) {
        database.remove(person)
    }

    init {
        this.database = database
        this.view = view
        this.database.setOnDatabaseListener(object : DatabaseListener() {
            fun onChanged() {
                this@MainPresenter.view.notifyDataChanged()
            }
        })
    }
}
```

---

### MVVM ë””ìì¸ íŒ¨í„´

- MVP íŒ¨í„´ì• ì„œëŠ” Presenterê°€ viewì— ì–´ë–¤ ì¼ì„ ìš”ì²­í•˜ëŠ”ì§€ ëª…ë°±íˆ í™•ì¸ì´ ê°€ëŠ¥í–ˆë‹¤
- í•˜ì§€ë§Œ, View ì™€ Presenter ê°€ ê°•í•˜ê²Œ ê²°í•©ë˜ëŠ” ë¬¸ì œì ì´ ìˆìŒ
- MVVM ì—ì„œëŠ” ë°ì´í„° ë°”ì¸ë”© ë° LiveData ë˜ëŠ” RxJava ê°™ì€ Observable íƒ€ì…ì„ ì´ìš©í•˜ì—¬ Presenterì™€ View ì‚¬ì´ ì˜ì¡´ë ¥ì„ ëŠëŠ”ë° ì§‘ì¤‘í•œë‹¤.
- Presenter ëŒ€ì‹  ViewModel ì´ë¼ëŠ” êµ¬ì„± ìš”ì†Œë¥¼ ì‚¬ìš©!
- ViewModel
    - View ì— í‘œí˜„í•  ë°ì´í„°ë¥¼ Observable íƒ€ì…ìœ¼ë¡œ ê´€ë¦¬
    - View ë“¤ì´ ViewModel ë°ì´í„°ë¥¼ êµ¬ë…! ìš”ì²­í•˜ì—¬ í™”ë©´ì— ë‚˜íƒ€ëƒ„
    - ViewModel : View = 1 : N ê´€ê³„ë¥¼ ê°€ì§„ë‹¤! ğŸ˜²
- ViewModel ì´ View ì— ëŠìŠ¨í•˜ê²Œ ì—°ê²°ë˜ë„ë¡ Data Binding ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤

![MVVM ë””ìì¸ íŒ¨í„´ ë‹¤ì´ì–´ê·¸ë¨]()

- ìƒëª… ì£¼ê¸° or ìœ ì € ìƒí˜¸ì‘ìš©ì— ë”°ë¥¸ ViewModelì˜ Model ë°ì´í„° ìš”ì²­
- Modelë¡œë¶€í„° ë°›ì€ ë°ì´í„°ë¥¼ ê°€ê³µí•´ ê´€ì°°ê°€ëŠ¥í•œ(observable) íƒ€ì…ì˜ í˜•íƒœë¡œ ViewModelì— ì €ì¥
- Viewì™€ ViewModelì€ Databindingì´ ì´ë£¨ì–´ì ¸ì•¼í•¨
- ë°ì´í„° ìƒíƒœê°€ ë²¼ê²½ë˜ë©´ í•´ë‹¹ ë°ì´í„°ë¥¼ êµ¬ë…í•˜ëŠ” view ë“¤ì— ë³€ê²½ì‚¬í•­ì„ ì•Œë¦¬ê²Œë¨. ê·¸ëŸ¬ë©´ ë·° ì—…ë°ì´íŠ¸

#### ViewModel êµ¬í˜„í•˜ê¸°

- MainViewModel ì€ ë°ì´í„° ë°”ì¸ë”© íŒ¨í‚¤ì§€ì˜ BaseObservableì„ ìƒì†.
    - ë°ì´í„°ì— ë°˜ì‘í•´ì„œ ë·°ë¥¼ ê°±ì‹ í•  ìˆ˜ìˆë„ë¡ í•´ì¤€ ê²ƒ.
- í•µì‹¬ì€ MainViewModelì´ Person ëª©ë¡ì„ ê°€ì§€ë©°, View ê´€ë ¨ ì½”ë“œë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ë‹¤ëŠ” ê²ƒ!



[MainViewModel.kt]
```kotlin

class MainViewModel(database: Database) : BaseObservable() {
    private val database: Database
    private val items: MutableList<Person> = ArrayList<Person>()
    fun load() {
        items.clear()
        items.addAll(database.getPersonList())
        notifyChange()
    }

    fun addPerson(person: Person?) {
        database.add(person)
    }

    fun removePerson(person: Person) {
        database.remove(person)
    }

    fun getItems(): List<Person> {
        return items
    }

    init {
        this.database = database
        this.database.setOnDatabaseListener(object : DatabaseListener() {
            fun onChanged() {
                load()
            }
        })
    }
}
```


[MainActivity.kt]
```kotlin
class MainActivity : AppCompatActivity(), MainViewHolder.HolderClickListener {
    var viewModel: MainViewModel? = null
    ...
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = DataBindingUtil.setContentView(this, R.layout.activity_main)
        ...
        viewModel = MainViewModel(instance!!)
        binding!!.viewModel = viewModel
        viewModel!!.load()
    }

    override fun onOptionsItemSelected(item: MenuItem): Boolean {
        viewModel!!.addPerson(
            Person(
                System.currentTimeMillis(),
                String.format("New Charles %d", Random().nextInt(1000))
            )
        )
        return super.onOptionsItemSelected(item)
    }

    override fun onDeleteClick(person: Person) {
        viewModel!!.removePerson(person)
    }

    ...
}
```


[activity_main.kt]
```xml
<?xml version="1.0" encoding="utf-8"?>
<layout>
    <data>
        <variable
            name="viewModel"
            type="com.sample.viewmodel.MainViewModel" />
    </data>
    <androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:app="http://schemas.android.com/apk/res-auto"
        android:layout_width="match_parent"
        android:layout_height="match_parent">

        <androidx.recyclerview.widget.RecyclerView
            android:id="@+id/recycler_view"
            android:layout_width="0dp"
            android:layout_height="0dp"
            app:items="@{viewModel.items}"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent" />

    </androidx.constraintlayout.widget.ConstraintLayout>
</layout>
```

